# 概要と基本概念

## Webhook とは

Webhook は、特定のイベントが発生したときに、外部のサービスが HTTP POST リクエストを送信する仕組みです。これにより、リアルタイムでイベントに反応し、自動化されたワークフローを構築できます。

## Webhook の仕組み

```
┌─────────────┐       イベント発生       ┌─────────────┐
│             │ ────────────────────────> │             │
│  外部サービス │                          │ Webhook URL │
│  (GitHub等) │ <──────────────────────── │  (受信側)   │
│             │       HTTP POST           │             │
└─────────────┘                          └─────────────┘
         │                                      │
         │                                      │
         └──────── ペイロード（JSON）────────────┘
```

### 主要なコンポーネント

1. **イベントソース**: イベントを発生させる外部サービス（GitHub、Slack、Datadog など）
2. **Webhook URL**: イベント通知を受け取るエンドポイント
3. **ペイロード**: イベントの詳細情報を含む JSON データ
4. **署名**: リクエストが正当なソースから送信されたことを検証するための情報

## Webhook のメリット

### 1. リアルタイム性

ポーリング（定期的な確認）と異なり、イベント発生時に即座に通知されます。

**ポーリング方式**:
```
サービス → API確認 → API確認 → API確認 → イベント発見！
           (1分後)   (2分後)   (3分後)
```

**Webhook 方式**:
```
サービス → イベント発生 → 即座に通知！
```

### 2. 効率性

- 不要な API リクエストを削減
- サーバーリソースの節約
- レート制限を気にする必要がない

### 3. 自動化

- 人手を介さずにワークフローを実行
- 複数のサービスを連携
- エラー発生時の即座な対応

## Webhook の典型的なユースケース

### 1. CI/CD パイプライン

GitHub にコードがプッシュされたら、自動的にビルドとテストを実行。

```
GitHub Push → Webhook → ビルドサーバー起動
```

### 2. 通知システム

重大なエラーが発生したら、担当者に即座に通知。

```
エラー検出 → Webhook → Slack 通知 / メール送信
```

### 3. データ同期

あるシステムでデータが更新されたら、他のシステムも更新。

```
CRM 更新 → Webhook → データベース同期
```

### 4. イベント駆動型ワークフロー

特定の条件が満たされたら、次のアクションを実行。

```
注文完了 → Webhook → 在庫更新 → 配送手配
```

## Webhook のセキュリティ

Webhook は公開されたエンドポイントであるため、セキュリティが重要です。

### 1. 署名検証

送信者が正当なサービスであることを検証します。

```
送信側: HMAC(秘密鍵, ペイロード) → 署名
受信側: 署名を検証 → OK/NG
```

### 2. HTTPS の使用

通信を暗号化し、中間者攻撃を防ぎます。

### 3. IP ホワイトリスト（オプション）

特定の IP アドレスからのリクエストのみを許可します。

## Webhook vs API

| 特性 | Webhook | API |
|------|---------|-----|
| 通信方向 | プッシュ（送信側主導） | プル（受信側主導） |
| リアルタイム性 | 即座 | ポーリング間隔による遅延 |
| リソース効率 | 高い | 低い（無駄なリクエスト） |
| 実装の複雑さ | 受信エンドポイントが必要 | クライアントのみ |
| エラーハンドリング | 再送信が必要 | リトライが容易 |

## まとめ

Webhook は、イベント駆動型のアーキテクチャを実現するための強力なツールです。リアルタイム性と効率性を兼ね備え、様々な自動化シナリオで活用できます。

次のページでは、agentapi-proxy で Webhook をどのように活用できるかを見ていきましょう。
